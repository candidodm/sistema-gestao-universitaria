<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastrar Pessoa Física - Sistema de Gestão Universitária</title>
    <link rel="stylesheet" href="../css/styles.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect width="40" height="40" rx="8" fill="#2563eb"/>
                    <path d="M20 10L10 15V25L20 30L30 25V15L20 10Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M10 15L20 20L30 15" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M20 20V30" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <h1>Sistema de Gestão Universitária</h1>
            </div>
            <div class="user-info">
                <span>Administrador</span>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <a href="../index.html" class="back-button">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="19" y1="12" x2="5" y2="12"></line>
                    <polyline points="12 19 5 12 12 5"></polyline>
                </svg>
                Voltar ao Menu
            </a>

            <div class="form-container">
                <div class="form-header">
                    <h2>Cadastrar Pessoa Física</h2>
                    <p>Preencha os dados abaixo para registrar uma nova pessoa física</p>
                </div>

                <!-- Alert Area -->
                <div id="alert" class="alert"></div>

                <!-- Success Message -->
                <div id="successMessage" class="success-message">
                    <h3>
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                            <polyline points="22 4 12 14.01 9 11.01"></polyline>
                        </svg>
                        Cadastro realizado com sucesso!
                    </h3>
                    <p><strong>ID:</strong> <span id="pessoaId"></span></p>
                    <p><strong>Nome:</strong> <span id="pessoaNome"></span></p>
                    <p><strong>CPF:</strong> <span id="pessoaCPF"></span></p>
                </div>

                <!-- Form -->
                <form id="formCadastroPF">
                    <div class="form-group">
                        <label for="nomeCompleto" class="required">Nome Completo</label>
                        <input 
                            type="text" 
                            id="nomeCompleto" 
                            name="nomeCompleto" 
                            required
                            placeholder="Digite o nome completo"
                        >
                        <span class="error-message" id="errorNome"></span>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="cpf" class="required">CPF</label>
                            <input 
                                type="text" 
                                id="cpf" 
                                name="cpf" 
                                required
                                placeholder="000.000.000-00"
                                maxlength="14"
                            >
                            <span class="error-message" id="errorCPF"></span>
                        </div>

                        <div class="form-group">
                            <label for="dataNascimento" class="required">Data de Nascimento</label>
                            <input 
                                type="date" 
                                id="dataNascimento" 
                                name="dataNascimento" 
                                required
                            >
                            <span class="error-message" id="errorDataNascimento"></span>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="email" class="required">E-mail</label>
                            <input 
                                type="email" 
                                id="email" 
                                name="email" 
                                required
                                placeholder="exemplo@email.com"
                            >
                            <span class="error-message" id="errorEmail"></span>
                        </div>

                        <div class="form-group">
                            <label for="telefone" class="required">Telefone</label>
                            <input 
                                type="tel" 
                                id="telefone" 
                                name="telefone" 
                                required
                                placeholder="(00) 00000-0000"
                                maxlength="15"
                            >
                            <span class="error-message" id="errorTelefone"></span>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-outline" onclick="limparFormulario()">
                            Limpar
                        </button>
                        <button type="submit" class="btn btn-primary">
                            Cadastrar
                        </button>
                    </div>
                </form>

                <!-- Loading -->
                <div id="loading" class="loading">
                    <div class="spinner"></div>
                    <p>Processando cadastro...</p>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <p>&copy; 2025 Sistema de Gestão Universitária - Projeto Integrador Grupo 48</p>
        </footer>
    </div>

    <script src="../js/script.js"></script>
    <script>
        // Máscaras de input
        document.getElementById('cpf').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length <= 11) {
                value = value.replace(/(\d{3})(\d)/, '$1.$2');
                value = value.replace(/(\d{3})(\d)/, '$1.$2');
                value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
                e.target.value = value;
            }
        });

        document.getElementById('telefone').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length <= 11) {
                value = value.replace(/(\d{2})(\d)/, '($1) $2');
                value = value.replace(/(\d{5})(\d)/, '$1-$2');
                e.target.value = value;
            }
        });

        // Validação do formulário
        document.getElementById('formCadastroPF').addEventListener('submit', async function(e) {
            e.preventDefault();

            // Limpar mensagens anteriores
            limparMensagens();

            // Validar campos
            const nomeCompleto = document.getElementById('nomeCompleto').value.trim();
            const cpf = document.getElementById('cpf').value.replace(/\D/g, '');
            const dataNascimento = document.getElementById('dataNascimento').value;
            const email = document.getElementById('email').value.trim();
            const telefone = document.getElementById('telefone').value.replace(/\D/g, '');

            let valid = true;

            // Validação do nome
            if (nomeCompleto.length < 3) {
                mostrarErro('errorNome', 'Nome deve ter pelo menos 3 caracteres');
                document.getElementById('nomeCompleto').classList.add('invalid');
                valid = false;
            } else {
                document.getElementById('nomeCompleto').classList.add('valid');
            }

            // Validação do CPF
            if (cpf.length !== 11 || !validarCPF(cpf)) {
                mostrarErro('errorCPF', 'CPF inválido');
                document.getElementById('cpf').classList.add('invalid');
                valid = false;
            } else {
                document.getElementById('cpf').classList.add('valid');
            }

            // Validação da data
            if (!dataNascimento) {
                mostrarErro('errorDataNascimento', 'Data de nascimento é obrigatória');
                document.getElementById('dataNascimento').classList.add('invalid');
                valid = false;
            } else {
                document.getElementById('dataNascimento').classList.add('valid');
            }

            // Validação do email
            if (!validarEmail(email)) {
                mostrarErro('errorEmail', 'E-mail inválido');
                document.getElementById('email').classList.add('invalid');
                valid = false;
            } else {
                document.getElementById('email').classList.add('valid');
            }

            // Validação do telefone
            if (telefone.length < 10) {
                mostrarErro('errorTelefone', 'Telefone inválido');
                document.getElementById('telefone').classList.add('invalid');
                valid = false;
            } else {
                document.getElementById('telefone').classList.add('valid');
            }

            if (!valid) {
                mostrarAlerta('Corrija os erros antes de continuar', 'error');
                return;
            }

            // Mostrar loading
            document.getElementById('loading').classList.add('show');
            document.querySelector('.form-actions').style.display = 'none';

            // Simular chamada ao backend (em produção, seria uma requisição AJAX)
            setTimeout(() => {
                // Esconder loading
                document.getElementById('loading').classList.remove('show');
                document.querySelector('.form-actions').style.display = 'flex';

                // Simular resposta de sucesso
                const pessoaId = 'PF-' + Math.random().toString(36).substr(2, 9).toUpperCase();
                
                // Mostrar mensagem de sucesso
                document.getElementById('pessoaId').textContent = pessoaId;
                document.getElementById('pessoaNome').textContent = nomeCompleto;
                document.getElementById('pessoaCPF').textContent = document.getElementById('cpf').value;
                document.getElementById('successMessage').classList.add('show');
                document.getElementById('formCadastroPF').style.display = 'none';

                // Scroll para o topo
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }, 1500);
        });

        function limparFormulario() {
            document.getElementById('formCadastroPF').reset();
            limparMensagens();
            document.getElementById('successMessage').classList.remove('show');
            document.getElementById('formCadastroPF').style.display = 'block';
        }

        function limparMensagens() {
            document.querySelectorAll('.error-message').forEach(el => el.classList.remove('show'));
            document.querySelectorAll('input').forEach(el => {
                el.classList.remove('valid', 'invalid');
            });
            document.getElementById('alert').classList.remove('show');
        }

        function mostrarErro(elementId, mensagem) {
            const errorElement = document.getElementById(elementId);
            errorElement.textContent = mensagem;
            errorElement.classList.add('show');
        }

        function mostrarAlerta(mensagem, tipo) {
            const alert = document.getElementById('alert');
            alert.textContent = mensagem;
            alert.className = 'alert alert-' + tipo + ' show';
        }

        function validarCPF(cpf) {
            if (cpf.length !== 11 || /^(\d)\1{10}$/.test(cpf)) return false;
            
            let soma = 0;
            for (let i = 0; i < 9; i++) {
                soma += parseInt(cpf.charAt(i)) * (10 - i);
            }
            let resto = 11 - (soma % 11);
            let digito1 = resto >= 10 ? 0 : resto;
            
            if (digito1 !== parseInt(cpf.charAt(9))) return false;
            
            soma = 0;
            for (let i = 0; i < 10; i++) {
                soma += parseInt(cpf.charAt(i)) * (11 - i);
            }
            resto = 11 - (soma % 11);
            let digito2 = resto >= 10 ? 0 : resto;
            
            return digito2 === parseInt(cpf.charAt(10));
        }

        function validarEmail(email) {
            const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return regex.test(email);
        }
    </script>
</body>
</html>
