<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastrar Pessoa Física - Sistema de Gestão Universitária</title>
    <link rel="stylesheet" href="../css/styles.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="logo">
                <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect width="40" height="40" rx="8" fill="#2563eb"/>
                    <path d="M20 10L10 15V25L20 30L30 25V15L20 10Z" stroke="white" stroke-width="2"/>
                </svg>
                <h1>Sistema de Gestão Universitária</h1>
            </div>
            <div class="user-info"><span>Administrador</span></div>
        </header>

        <main class="main-content">
            <a href="../index.html" class="back-button">← Voltar ao Menu</a>

            <div class="form-container">
                <div class="form-header">
                    <h2>Cadastrar Pessoa Física</h2>
                    <p>✅ Conectado ao backend Java - dados serão salvos no servidor</p>
                </div>

                <div id="alert" class="alert"></div>
                <div id="successMessage" class="success-message">
                    <h3>✓ Cadastro realizado com sucesso no backend!</h3>
                    <p><strong>ID:</strong> <span id="pessoaId"></span></p>
                    <p><strong>Nome:</strong> <span id="pessoaNome"></span></p>
                    <p><strong>CPF:</strong> <span id="pessoaCPF"></span></p>
                </div>

                <form id="formCadastroPF">
                    <div class="form-group">
                        <label for="nomeCompleto" class="required">Nome Completo</label>
                        <input type="text" id="nomeCompleto" name="nomeCompleto" required placeholder="Digite o nome completo">
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="cpf" class="required">CPF</label>
                            <input type="text" id="cpf" name="cpf" required placeholder="000.000.000-00" maxlength="14">
                        </div>
                        <div class="form-group">
                            <label for="dataNascimento" class="required">Data de Nascimento</label>
                            <input type="date" id="dataNascimento" name="dataNascimento" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="email" class="required">E-mail</label>
                            <input type="email" id="email" name="email" required placeholder="exemplo@email.com">
                        </div>
                        <div class="form-group">
                            <label for="telefone" class="required">Telefone</label>
                            <input type="tel" id="telefone" name="telefone" required placeholder="(00) 00000-0000" maxlength="15">
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-outline" onclick="limparFormulario()">Limpar</button>
                        <button type="submit" class="btn btn-primary">Cadastrar no Backend Java</button>
                    </div>
                </form>

                <div id="loading" class="loading">
                    <div class="spinner"></div>
                    <p>Enviando para o backend Java...</p>
                </div>
            </div>
        </main>

        <footer class="footer">
            <p>&copy; 2025 Sistema de Gestão Universitária - Conectado ao Backend Java</p>
        </footer>
    </div>

    <script src="../js/script.js"></script>
    <script src="../js/api.js"></script>
    <script>
        // Máscaras
        document.getElementById('cpf').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            value = value.replace(/(\d{3})(\d)/, '$1.$2');
            value = value.replace(/(\d{3})(\d)/, '$1.$2');
            value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
            e.target.value = value;
        });

        document.getElementById('telefone').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            value = value.replace(/(\d{2})(\d)/, '($1) $2');
            value = value.replace(/(\d{5})(\d)/, '$1-$2');
            e.target.value = value;
        });

        // Formulário conectado ao backend Java
        document.getElementById('formCadastroPF').addEventListener('submit', async function(e) {
            e.preventDefault();

            // Coletar dados
            const dados = {
                nomeCompleto: document.getElementById('nomeCompleto').value.trim(),
                cpf: document.getElementById('cpf').value.replace(/\D/g, ''),
                dataNascimento: document.getElementById('dataNascimento').value,
                email: document.getElementById('email').value.trim(),
                telefone: document.getElementById('telefone').value.replace(/\D/g, '')
            };

            // Validações client-side
            if (!validarCPF(dados.cpf)) {
                mostrarAlerta('CPF inválido', 'error');
                return;
            }

            if (!validarEmail(dados.email)) {
                mostrarAlerta('E-mail inválido', 'error');
                return;
            }

            // Mostrar loading
            mostrarLoading(true);

            // Enviar para backend Java via API
            const resultado = await cadastrarPessoaFisica(dados);

            // Esconder loading
            mostrarLoading(false);

            // Processar resposta
            if (resultado.sucesso) {
                // Mostrar dados retornados pelo backend
                document.getElementById('pessoaId').textContent = resultado.id || 'N/A';
                document.getElementById('pessoaNome').textContent = resultado.pessoa?.nomeCompleto || dados.nomeCompleto;
                document.getElementById('pessoaCPF').textContent = document.getElementById('cpf').value;
                
                document.getElementById('successMessage').classList.add('show');
                document.getElementById('formCadastroPF').style.display = 'none';
                
                mostrarAlerta(resultado.mensagem || 'Cadastro realizado com sucesso!', 'success');
            } else {
                mostrarAlerta(resultado.mensagem || 'Erro ao cadastrar', 'error');
            }
        });

        function limparFormulario() {
            document.getElementById('formCadastroPF').reset();
            document.getElementById('successMessage').classList.remove('show');
            document.getElementById('formCadastroPF').style.display = 'block';
        }
    </script>
</body>
</html>
